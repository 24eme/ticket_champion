{{> header}}

<section class="d-flex justify-content-center">

  <h2 class="text-center texte-intro">Bonjour {{employee}}, que veux-tu manger ?</h2>
  <div class="row">
    <form action="/plats" method="POST">
    <div class="row container-card col-md-8">
      {{#each data.data.restaurants.[0].plats}}
        <div class="col-sm-2 card-plats">
          <div class="card">
            <img class="card-img-top" src={{this.img}} alt="image du plat" style="border-radius: 15px;">
            <div class="card-body">
              <h5 class="card-title">{{this.nom}} - {{this.prix}}€</h5>
              <p class="liste-ingredients">{{this.ingredients}}</p>
              <input type="hidden" id="button-hidden{{@index}}" name="{{this.nom}},{{this.prix}}" value="0"/>
              <input type="button" id="{{this.prix}}" class="btn btn-primary bouton-plats" name="{{this.nom}}" value="Ajouter à la commande" onclick="addValue('button-hidden{{@index}}');" />
               
            </div>
          </div>
        </div>
      {{/each}}
      {{!-- <input type="hidden" id="button-hidden" name="Mon bouton hidden" value=""/> --}}
     

    </div>
   
    
    

    <div class="col-md-1 shadowed-div" style="border-radius: 15px;">
      <section id="recap-section">
        <h2 class="text-center texte-intro" style="font-size: 1.5rem">Panier</h2>
        <ul id="recap-commande">
          {{#each plats}}
          <li class ="commande-existante" data-name="{{this.nom_plat}}" data-prix ="{{this.prix}}" data-quantite ="{{this.quantite}}" > {{this.quantite}} x {{this.nom_plat}} - {{this.prix}}€</li> 
          {{/each}}
        </ul>
        <ul><li>Total : <span id="total-amount" class="montant">{{montant}}</span></li></ul>
      </section>
    </div>
  </div>

<div class="container-prev-next">
  <a href='/clients'>
    <button class="btn btn-primary btn-previous" name="pre"> Précédent </button>
  </a>
  
    <input type="submit" class="btn btn-primary btn-next" name="next" value="Suivant"/>
    
  
</div>
 </form>



</section>

<script>

   function updateTotal(commande) {
        let total = 0;

        Object.keys(commande).forEach((plat) => {
          total += commande[plat].quantite * commande[plat].prix;
        });

        const totalItem = document.querySelector('#recap-commande li:last-child');
        totalItem.textContent = `Total : ${total}€`;
      }

function addValue(id) {

  const buttonHidden = document.getElementById(id);
  
  buttonHidden.value++;
  console.log(buttonHidden.value);
   
  }

  
//  const commadeExistante = document.querySelectorAll('.commande-existante');
  let commande = {};
  //commadeExistante.forEach(boutton =>{

  //  console.log("le bouton ", boutton.dataset.name)

    
   // commande[boutton.dataset.name] = {
     // quantite : boutton.datset.quantite,
     // prix : boutton.dataset.prix
   // };
   

 // });
  console.log("c'est la commande : ", commande);

  allBoutonplat = document.querySelectorAll(".bouton-plats");
  const recapCommande = document.getElementById('recap-commande');

  allBoutonplat.forEach(boutton => {

    boutton.addEventListener('click', (event) => {


        const commadeExistante = document.querySelectorAll('.commande-existante');
        let commande = {};
       commadeExistante.forEach(boutton =>{

            console.log("le bouton ", boutton.dataset.name)

    
    commande[boutton.dataset.name] = {
      quantite : boutton.dataset.quantite,
      prix : boutton.dataset.prix
    };
   

  });

      const nomPlat = event.target.name;
      const prix = event.target.id;
      //console.log('le nom du plats', nomPlat);

 

      if (commande.hasOwnProperty(nomPlat)) {
        commande[nomPlat].quantite ++;
      } else {
        commande[nomPlat] = {
          quantite: 1,
          prix: prix
        };
      }


      //affichage 

      

      recapCommande.innerHTML = '';
      Object.keys(commande).forEach((plat) => {

        console.log("c ets le plats : ",plat)

        const item = document.createElement('li');
        item.setAttribute('data-name', plat);
        item.setAttribute('class', 'commande-existante');
        item.setAttribute('data-prix', commande[plat].prix);
        item.setAttribute('data-quantite', commande[plat].quantite);
        item.innerHTML += `${commande[plat].quantite} x ${plat} - ${commande[plat].prix}€`;
        recapCommande.appendChild(item);



      });
      
      
      


    });

  })



   
   
     
</script>

{{> footer}}
